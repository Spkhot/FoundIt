<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>All Lost Item Requests | FoundIt Hub</title>
  <link rel="icon" href="logo.png"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate-fadeInUp {
      animation: fadeInUp 0.6s ease-out forwards;
      opacity: 0;
    }

    #requestsContainer > div {
      animation: fadeInUp 0.5s ease-out forwards;
    }
  </style>
</head>
<body class="bg-slate-900 text-white">

  <div class="max-w-6xl mx-auto px-4 py-12">
    <h1 class="text-3xl md:text-4xl font-bold text-center text-cyan-400 mb-10 animate-fadeInUp">
      All Lost Item Requests
    </h1>

    <div id="requestsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Requests will be populated here -->
    </div>

    <div id="emptyState" class="text-center text-slate-400 mt-12 hidden">
      No lost item requests found.
    </div>
  </div>

  <script>
    const BASE_URL = location.hostname === "localhost"
      ? "http://localhost:5000"
      : "https://foundit-imky.onrender.com";

    const container = document.getElementById('requestsContainer');
    const emptyState = document.getElementById('emptyState');

    async function loadRequests() {
      try {
        const res = await fetch(`${BASE_URL}/api/requests`);
        const requests = await res.json();

        if (!Array.isArray(requests) || requests.length === 0) {
          emptyState.classList.remove('hidden');
          return;
        }

        requests.forEach((req, index) => {
          const div = document.createElement('div');
          div.className = "bg-slate-800/50 border border-white/10 rounded-xl p-6 shadow-lg space-y-3";
          div.style.animationDelay = `${index * 100}ms`;

          div.innerHTML = `
            ${req.category ? `<span class="inline-block bg-cyan-700 text-white px-3 py-1 rounded-full text-xs mb-2">${req.category}</span>` : ""}
            <h2 class="text-xl font-bold text-cyan-300">${req.productName}</h2>
            <p><span class="text-slate-400">Lost at:</span> ${req.location}</p>
            <p><span class="text-slate-400">Description:</span> ${req.description}</p>
            <p><span class="text-slate-400">Contact:</span> ${req.contact}</p>
            ${req.reward ? `<p class="text-yellow-400 font-semibold">üéÅ Reward: ${req.reward}</p>` : ""}
            <p class="text-xs text-slate-500">Posted on ${new Date(req.createdAt).toLocaleString()}</p>
            <button onclick="deleteRequest('${req._id}')" class="mt-2 bg-red-600 hover:bg-red-500 text-white px-4 py-1 rounded-full text-sm transition">
              üóëÔ∏è Delete
            </button>
          `;
          container.appendChild(div);
        });

      } catch (err) {
        console.error("Error loading requests:", err);
        emptyState.textContent = "Failed to load requests. Try again later.";
        emptyState.classList.remove('hidden');
      }
    }

    async function deleteRequest(id) {
      const confirmDelete = confirm("Are you sure you want to delete this request?");
      if (!confirmDelete) return;

      try {
        const res = await fetch(`${BASE_URL}/api/requests/${id}`, { method: "DELETE" });
        if (res.ok) {
          alert("Request deleted successfully.");
          location.reload();
        } else {
          alert("Failed to delete request.");
        }
      } catch (err) {
        console.error("Delete failed:", err);
        alert("An error occurred while deleting.");
      }
    }

    document.addEventListener("DOMContentLoaded", loadRequests);
  </script>
</body>
</html>
