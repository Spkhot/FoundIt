<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Post Found Item | FoundIt Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="logo.png"/>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
    @keyframes logoPulse {
    0%, 100% {
      transform: scale(1);
      opacity: 0.6;
    }
    50% {
      transform: scale(1.2);
      opacity: 1;
    }
  }

  .animate-logo {
    animation: logoPulse 1.5s ease-in-out infinite;
  }

  #loader {
    transition: opacity 0.5s ease;
  }
    
    @keyframes backgroundPan {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .animated-gradient {
      background: linear-gradient(135deg, #6B21A8, #3B82F6, #EC4899, #F59E0B);
      background-size: 400% 400%;
      animation: backgroundPan 15s ease infinite;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeInUp {
      animation: fadeInUp 0.6s ease-out forwards;
      opacity: 0; /* Start hidden */
    }
    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
    .delay-3 { animation-delay: 0.3s; }
    .delay-4 { animation-delay: 0.4s; }
  </style>
</head>
<body class="bg-slate-900 text-white">
<!-- Custom Loader -->
<div id="loader" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900 text-white">
  <h1 class="text-4xl font-extrabold tracking-wide animate-logo text-cyan-400">FoundIt</h1>
</div>

  <!-- Animated Background -->
  <div class="animated-gradient fixed top-0 left-0 w-full h-full z-0"></div>

  <!-- Content Wrapper -->
  <div class="relative z-10 min-h-screen flex items-center justify-center px-4 py-10">
    <div class="w-full max-w-2xl">
      
      <!-- Main Card -->
      <div class="bg-slate-800/50 backdrop-blur-lg border border-white/10 rounded-2xl shadow-2xl p-6 md:p-8 animate-fadeInUp">
        
        <div class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-extrabold text-white">Report a Found Item</h1>
            <p class="text-slate-300 mt-2">Thank you for your kindness. Please fill out the details below.</p>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
            <a href="index.html" class="bg-white/10 border border-white/20 text-white font-semibold py-2 px-6 rounded-full transition-all transform hover:scale-105 hover:bg-white/20 duration-300 text-center">
              Go Home
            </a>
            <a href="find.html" class="bg-cyan-600 hover:bg-cyan-500 text-white font-semibold py-2 px-6 rounded-full transition-all transform hover:scale-105 duration-300 text-center">
              I Lost Something
            </a>
        </div>

        <form id="foundForm" class="space-y-5" enctype="multipart/form-data">
          <!-- Form Fields -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <input name="productName" placeholder="What is the item?" required class="w-full bg-slate-700/50 border border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none transition" />
            <select name="category" required class="w-full bg-slate-700/50 border border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none transition">
              <option value="" disabled selected>Select a Category</option>
              <option value="wallet">Wallet</option>
              <option value="id">ID Card</option>
              <option value="key">Keys</option>
              <option value="documents">Documents</option>
              <option value="shoes">Shoes</option>
              <option value="electronics">Electronics</option>
              <option value="other">Other</option>
            </select>
          </div>
          
          <input name="location" placeholder="Where did you find it?" required class="w-full bg-slate-700/50 border border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none transition" />
          <textarea name="description" placeholder="Describe the item (color, brand, any unique marks...)" required rows="4" class="w-full bg-slate-700/50 border border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none transition"></textarea>
<input id="emailInput" name="contact" placeholder="Your Email" type="email" required class="w-full bg-slate-700/50 border border-slate-600 rounded-lg p-3 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none transition" />

<div class="flex items-center gap-3 mt-2">
  <button type="button" id="sendOtpBtn" class="px-4 py-2 bg-cyan-600 text-white rounded hover:bg-cyan-700 transition">Send OTP</button>
  <input type="text" id="otpInput" placeholder="Enter OTP" class="flex-1 px-3 py-2 bg-slate-700/50 text-white border border-slate-600 rounded" />
  <button type="button" id="verifyOtpBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition">Verify</button>
</div>

<div id="otpStatus" class="text-sm mt-2 text-cyan-300 hidden"></div>

          <!-- Custom File Input -->
          <div>
            <label for="imageUpload" class="w-full cursor-pointer bg-slate-700/50 border-2 border-dashed border-slate-600 rounded-lg p-4 flex flex-col items-center justify-center hover:bg-slate-700 hover:border-cyan-400 transition">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-slate-400 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
              <span id="file-chosen" class="text-slate-300 font-semibold">Upload a Photo of the Item</span>
            </label>
<!-- üîß REPLACED class="hidden" with visually-hidden style but still focusable -->
               <input type="file" id="imageUpload" name="image" accept="image/*" required style="position:absolute; left:-9999px;" />
          </div>

          <!-- Message Area -->
          <div id="message" class="text-center mt-4 text-lg font-semibold"></div>

          <!-- Submit Button -->
          <button type="submit" id="submitBtn" class="w-full bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-3 px-4 rounded-lg font-bold text-lg hover:opacity-90 transition-opacity transform hover:scale-[1.02] duration-300">
            Post Item
          </button>
        </form>
      </div>

    </div>
  </div>

 <script>
  window.addEventListener("load", () => {
    const loader = document.getElementById("loader");
    loader.classList.add("opacity-0");
    setTimeout(() => loader.style.display = "none", 500);
  });
  document.addEventListener("DOMContentLoaded", () => {
    const BASE_URL = location.hostname === "localhost"
      ? "http://localhost:10000"
      : "https://foundit-imky.onrender.com";

    const form = document.getElementById('foundForm');
    const message = document.getElementById('message');
    const submitBtn = document.getElementById('submitBtn');
    const imageUpload = document.getElementById('imageUpload');
    const fileChosen = document.getElementById('file-chosen');
  
     let isOtpVerified = false;
const sendOtpBtn = document.getElementById("sendOtpBtn");
const verifyOtpBtn = document.getElementById("verifyOtpBtn");
const emailInput = document.getElementById("emailInput");
const otpInput = document.getElementById("otpInput");
const otpStatus = document.getElementById("otpStatus");

// Send OTP
sendOtpBtn.addEventListener("click", async () => {
  const email = emailInput.value.trim();
  if (!email) return alert("Please enter your email first");

  try {
    const res = await fetch(`${BASE_URL}/api/otp/send`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email }),
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Failed to send OTP");

    otpStatus.textContent = "‚úÖ OTP sent to your email.";
    otpStatus.className = "text-green-400 mt-2";
    otpStatus.classList.remove("hidden");
  } catch (err) {
    otpStatus.textContent = `‚ùå ${err.message}`;
    otpStatus.className = "text-red-400 mt-2";
    otpStatus.classList.remove("hidden");
  }
});

// Verify OTP
verifyOtpBtn.addEventListener("click", async () => {
  const email = emailInput.value.trim();
  const otp = otpInput.value.trim();
  if (!email || !otp) return alert("Enter email and OTP");

  try {
    const res = await fetch(`${BASE_URL}/api/otp/verify`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, otp }),
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Invalid OTP");

    isOtpVerified = true;
    otpStatus.textContent = "‚úÖ OTP verified successfully!";
    otpStatus.className = "text-green-400 mt-2";
    otpStatus.classList.remove("hidden");
  } catch (err) {
    otpStatus.textContent = `‚ùå ${err.message}`;
    otpStatus.className = "text-red-400 mt-2";
    otpStatus.classList.remove("hidden");
  }
});


    // ‚úÖ File input label update
    imageUpload.addEventListener('change', () => {
      fileChosen.textContent = imageUpload.files.length > 0
        ? imageUpload.files[0].name
        : 'Upload a Photo of the Item';
    });

    // ‚úÖ Handle form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);

      message.textContent = "Submitting...";
      message.className = "text-center mt-4 text-lg font-semibold text-yellow-400";
      submitBtn.disabled = true;
      submitBtn.textContent = "Posting...";
       if (!isOtpVerified) {
  message.textContent = "‚ùå Please verify OTP before submitting.";
  message.className = 'text-center mt-4 text-lg font-semibold text-red-400';
  message.classList.remove('hidden');
  submitBtn.disabled = false;
  submitBtn.textContent = 'Post Item';
  return;
}

      try {
        const res = await fetch(`${BASE_URL}/api/items`, {
          method: 'POST',
          body: formData
        });

        const contentType = res.headers.get("content-type");
        let data;

        if (contentType && contentType.includes("application/json")) {
          data = await res.json();
        } else {
          const text = await res.text();
          throw new Error(`Server error (HTML): ${text}`);
        }

        if (res.ok) {
          message.innerHTML = `‚úÖ Item posted successfully! Thank you.`;
          message.className = "text-center mt-4 text-lg font-semibold text-green-400";
          form.reset();
          fileChosen.textContent = 'Upload a Photo of the Item';
        } else {
          message.innerHTML = `‚ùå Failed to post item. ${data.message || 'Please check your input.'}`;
          message.className = "text-center mt-4 text-lg font-semibold text-red-400";
        }

      } catch (error) {
        console.error("‚ùå Submission error:", error.message);
        message.innerHTML = `‚ùå ${error.message.includes('<') ? 'Server returned invalid HTML instead of JSON.' : error.message}`;
        message.className = "text-center mt-4 text-lg font-semibold text-red-400";
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Post Item";
      }
    });
  });
</script>
</body>
</html>